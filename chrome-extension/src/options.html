<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MeetScribe - Options</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 40px;
      max-width: 600px;
      margin: 0 auto;
    }

    h1 {
      margin-bottom: 24px;
      color: #333;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .section h2 {
      font-size: 16px;
      margin-bottom: 16px;
      color: #333;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      color: #555;
    }

    input[type="text"],
    input[type="url"],
    input[type="number"],
    input[type="password"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    input:focus {
      outline: none;
      border-color: #4a4aff;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #4a4aff;
      color: white;
    }

    .btn-primary:hover {
      background: #5a5aff;
    }

    .message {
      padding: 10px;
      border-radius: 6px;
      margin-top: 16px;
      font-size: 14px;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>MeetScribe - Configuration</h1>

  <div class="section">
    <h2>Backend</h2>
    <div class="form-group">
      <label for="backend-url">URL du backend</label>
      <input type="url" id="backend-url" placeholder="http://192.168.1.19:8888">
    </div>
    <div class="form-group">
      <label for="api-token">Token API (optionnel)</label>
      <input type="password" id="api-token" placeholder="Laisser vide si pas d'auth">
    </div>
  </div>

  <div class="section">
    <h2>Enregistrement</h2>
    <div class="form-group">
      <label for="auto-start-delay">Délai avant auto-start (secondes)</label>
      <input type="number" id="auto-start-delay" min="0" max="30" value="5">
    </div>
    <div class="form-group">
      <label for="speaker-name">Nom du speaker local</label>
      <input type="text" id="speaker-name" placeholder="Dino">
    </div>
  </div>

  <button id="save-btn" class="btn btn-primary">Sauvegarder</button>

  <div id="message" class="message hidden"></div>

  <script>
    const backendUrl = document.getElementById('backend-url');
    const apiToken = document.getElementById('api-token');
    const autoStartDelay = document.getElementById('auto-start-delay');
    const speakerName = document.getElementById('speaker-name');
    const saveBtn = document.getElementById('save-btn');
    const messageEl = document.getElementById('message');

    // Load saved config
    chrome.storage.local.get(['backendUrl', 'apiToken', 'autoStartDelay', 'speakerName'], (config) => {
      backendUrl.value = config.backendUrl || 'http://192.168.1.19:8888';
      apiToken.value = config.apiToken || '';
      autoStartDelay.value = config.autoStartDelay || 5;
      speakerName.value = config.speakerName || 'Dino';
    });

    // Save config
    saveBtn.addEventListener('click', async () => {
      const config = {
        backendUrl: backendUrl.value,
        apiToken: apiToken.value || null,
        autoStartDelay: parseInt(autoStartDelay.value, 10),
        speakerName: speakerName.value,
      };

      await chrome.storage.local.set(config);

      // Notify service worker
      await chrome.runtime.sendMessage({
        type: 'UPDATE_CONFIG',
        target: 'service-worker',
        data: config,
      });

      showMessage('Configuration sauvegardée!', 'success');
    });

    function showMessage(text, type) {
      messageEl.textContent = text;
      messageEl.className = `message ${type}`;
      setTimeout(() => {
        messageEl.className = 'message hidden';
      }, 3000);
    }
  </script>
</body>
</html>
